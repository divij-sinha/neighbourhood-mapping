{% extends "_form_page.html" %}

{% block map_head %} 
{{ header|safe }} 
{%endblock %} 

{% block title_body %}
<div class="container-fluid p-3 text-center h-1">
  <h1>Where do you currently live?</h1>
</div>
{% endblock %} 

{% block dynamic_class %}
w-25
{% endblock %}

{% block map_body %}
{{ form_html }}
<form action="" method="post" novalidate id="mainform" class="needs-validation">
  {{ form.csrf_token }} 
  {{ form.mark_layer }}
</form>

<div class="container-fluid text-left fs-5 px-4">
  <p>
    To start drawing your neighborhood, first use the map to indicate generally where you live.
  </p>
  <p>
    <ol>
    <li>Pan to your approximate address by clicking and dragging the map.</li> 
    <li>Tap the <img src="/static/draw_icon.png" alt="white circle" width="25" /> icon then click on the map to mark your home's general location. </li>
    </ol>
  </p>
  <p>
    We will only look at your location as approximate coordinates and do not store your address.
  </p>
  <p class="fst-italic">
    Mark only 1 location! Use the
    <img src="/static/delete_icon.png" alt="trash" width="25" /> to delete a
    marker. Use the
    <img src="/static/edit_icon.png" alt="pencil" width="25" /> to move around
    or edit a marker.
  </p>
  {% if form.mark_layer.errors %}
  <p class="text-danger-custom">Mark the general location of where you live!</p>
  {% endif %}
</div>
<div class="container-fluid p-4">
  {{ body_html|safe }}
</div>
<div class="container-fluid text-center">
  <form>
    {{ form.submit(onclick="storeLayer()", form="mainform", class_="btn btn-primary btn-lg") }}
  </form>
</div>
<div class="container-fluid p-4"></div>
{% endblock %} 

{% block map_script %}
<script>
  {{script | safe}}
  var csrf_token = "{{ csrf_token() }}";
  function storeLayer() {
    var data = drawnItems.toGeoJSON();
    var convertedData =
      "text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(data));
    document
      .getElementById("mark_layer")
      .setAttribute("value", "data:" + convertedData);
  }
</script>
{% endblock %}
