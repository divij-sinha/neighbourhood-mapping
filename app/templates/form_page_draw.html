{% extends "_form_page.html" %}

{% block map_head %}
    {{ header|safe }}
{% endblock %}
    
{% block map_body %}
    <form action="" method="post" novalidate id="mainform">
        {{ form.hidden_tag() }}
        {% if first_time %}
        {% else %}
            {{ form.cur_neighbourhood.label }}
            {{ form.cur_neighbourhood }}
        {% endif %}
        {{ form.draw_another }}
    </form>
        {{ body_html|safe }}
        {{ form.submit(onclick="storeLayer()", form="mainform") }}
{% endblock %}

{% block map_script %}
        <script>
            {{ script|safe }}
            function storeLayer() {
                var data = drawnItems.toGeoJSON();
                var convertedData = 'text/json;charset=utf-8,'
                    + encodeURIComponent(JSON.stringify(data));
                document.getElementById('draw_layer').setAttribute(
                    'value', 'data:' + convertedData
                );                 
            }
        </script>
{% endblock %}

<!DOCTYPE html>
<html>
    <head>
        {{ header|safe }}
    </head>
    <body>
        <h1>CHICAGOANS' NEIGHBORHOOD MENTAL MAPS</h1>
        <br>
        <p>
            <h2>
            Draw your neighborhood!
            </h2>
        <p>
            <h6>
                By participating, you agree that you have read, understand and accept the Reader Submission Terms in relation to all of the content and other information you send to us ('Your Content'). If you do not accept these terms, please do not submit any content.
            </h6>
        </p>

        <form action="" method="post" novalidate id="mainform">
            {{ form.hidden_tag() }}
            {% if first_time %}
            {% else %}
                {{ form.cur_neighbourhood.label }}
                {{ form.cur_neighbourhood }}
            {% endif %}
            {{ form.draw_another }}
        </form>
            {{ body_html|safe }}
            {{ form.submit(onclick="storeLayer()", form="mainform") }}            
        <script>
            {{ script|safe }}
            function storeLayer() {
                var data = drawnItems.toGeoJSON();
                var convertedData = 'text/json;charset=utf-8,'
                    + encodeURIComponent(JSON.stringify(data));
                document.getElementById('draw_layer').setAttribute(
                    'value', 'data:' + convertedData
                );                 
            }
            
        </script>
    </body>
</html>

